{
    "title": "Vox — fn ダブルタップで音声入力トグル",
    "rules": [
        {
            "description": "fn ダブルタップ → SIGUSR1 + fn+F-key → 特殊機能キー",
            "manipulators": [
                {
                    "description": "fn ダブルタップ（2回目）→ SIGUSR1",
                    "type": "basic",
                    "from": {
                        "key_code": "fn",
                        "modifiers": { "optional": ["any"] }
                    },
                    "to": [
                        {
                            "shell_command": "kill -USR1 $(cat ~/.config/vox/vox.pid 2>/dev/null) 2>/dev/null"
                        },
                        {
                            "set_variable": {
                                "name": "vox_fn_pressed",
                                "value": 0
                            }
                        }
                    ],
                    "conditions": [
                        {
                            "type": "variable_if",
                            "name": "vox_fn_pressed",
                            "value": 1
                        }
                    ]
                },
                {
                    "description": "fn 1回目: fn_held 追跡 + ダブルタップ検出開始",
                    "type": "basic",
                    "from": {
                        "key_code": "fn",
                        "modifiers": { "optional": ["any"] }
                    },
                    "to": [
                        {
                            "set_variable": {
                                "name": "vox_fn_held",
                                "value": 1
                            }
                        },
                        {
                            "set_variable": {
                                "name": "vox_fn_pressed",
                                "value": 1
                            }
                        }
                    ],
                    "to_after_key_up": [
                        {
                            "set_variable": {
                                "name": "vox_fn_held",
                                "value": 0
                            }
                        }
                    ],
                    "to_delayed_action": {
                        "to_if_invoked": [
                            {
                                "set_variable": {
                                    "name": "vox_fn_pressed",
                                    "value": 0
                                }
                            }
                        ],
                        "to_if_canceled": [
                            {
                                "set_variable": {
                                    "name": "vox_fn_pressed",
                                    "value": 0
                                }
                            }
                        ]
                    },
                    "conditions": [
                        {
                            "type": "variable_unless",
                            "name": "vox_fn_pressed",
                            "value": 1
                        }
                    ],
                    "parameters": {
                        "basic.to_delayed_action_delay_milliseconds": 300
                    }
                },
                {
                    "description": "fn+F1 → Brightness Down",
                    "type": "basic",
                    "from": { "key_code": "f1", "modifiers": { "optional": ["any"] } },
                    "to": [{ "consumer_key_code": "display_brightness_decrement" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F2 → Brightness Up",
                    "type": "basic",
                    "from": { "key_code": "f2", "modifiers": { "optional": ["any"] } },
                    "to": [{ "consumer_key_code": "display_brightness_increment" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F3 → Mission Control",
                    "type": "basic",
                    "from": { "key_code": "f3", "modifiers": { "optional": ["any"] } },
                    "to": [{ "key_code": "mission_control" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F4 → Launchpad",
                    "type": "basic",
                    "from": { "key_code": "f4", "modifiers": { "optional": ["any"] } },
                    "to": [{ "key_code": "launchpad" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F5 → Illumination Down",
                    "type": "basic",
                    "from": { "key_code": "f5", "modifiers": { "optional": ["any"] } },
                    "to": [{ "key_code": "illumination_decrement" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F6 → Illumination Up",
                    "type": "basic",
                    "from": { "key_code": "f6", "modifiers": { "optional": ["any"] } },
                    "to": [{ "key_code": "illumination_increment" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F7 → Rewind",
                    "type": "basic",
                    "from": { "key_code": "f7", "modifiers": { "optional": ["any"] } },
                    "to": [{ "consumer_key_code": "rewind" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F8 → Play/Pause",
                    "type": "basic",
                    "from": { "key_code": "f8", "modifiers": { "optional": ["any"] } },
                    "to": [{ "consumer_key_code": "play_or_pause" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F9 → Fast Forward",
                    "type": "basic",
                    "from": { "key_code": "f9", "modifiers": { "optional": ["any"] } },
                    "to": [{ "consumer_key_code": "fastforward" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F10 → Mute",
                    "type": "basic",
                    "from": { "key_code": "f10", "modifiers": { "optional": ["any"] } },
                    "to": [{ "consumer_key_code": "mute" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F11 → Volume Down",
                    "type": "basic",
                    "from": { "key_code": "f11", "modifiers": { "optional": ["any"] } },
                    "to": [{ "consumer_key_code": "volume_decrement" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                },
                {
                    "description": "fn+F12 → Volume Up",
                    "type": "basic",
                    "from": { "key_code": "f12", "modifiers": { "optional": ["any"] } },
                    "to": [{ "consumer_key_code": "volume_increment" }],
                    "conditions": [{ "type": "variable_if", "name": "vox_fn_held", "value": 1 }]
                }
            ]
        }
    ]
}
